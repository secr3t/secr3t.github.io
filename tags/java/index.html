<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
	<meta charset="utf-8">

	

	<title>Dev.secr3t</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
	
	  
    
    <link rel="icon" href="/favicon.png">
    
<!--
	<link rel="preload" href="/css/D2Coding.woff2" as="font" type="font/woff2" crossorigin="anonymous">
	<link rel="preload" href="/css/D2Coding.ttf" as="font" type="font/ttf" crossorigin="anonymous">
	<link rel="preload" href="/css/D2CodingBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
	<link rel="preload" href="/css/D2CodingBold.ttf" as="font" type="font/ttf" crossorigin="anonymous">
	<link rel="stylesheet" href="/css/d2coding.css" type="text/css"> -->
	<link rel="preload" href="/css/D2Coding.woff" as="font" type="font/woff" crossorigin="anonymous">
	<link rel="preload" href="/css/D2CodingBold.woff" as="font" type="font/woff" crossorigin="anonymous">
	<!-- <link rel="preload" href="/css/style.css" as="style" type="text/css" crossorigin="anonymous"> -->
	<link rel="stylesheet" href="/css/normalize.css" type="text/css">
	<link rel="stylesheet" href="/css/basscss.css" type="text/css">
	<link rel="stylesheet" href="/css/basscss-ui-groups.css" type="text/css">
	<link rel="stylesheet" href="/css/tomorrow.css" type="text/css">
	<link rel="stylesheet" href="/css/style.css" type="text/css">
	
		<link href="https://rachel.objectstore.co/dist/fonts/lato-v13/lato-v13-all.css" rel="stylesheet" type="text/css">
	
	

	<!--[if lt IE 9]><script src="/js/html5.js" type="text/javascript"></script><![endif]-->
	<script src="/js/main.js" type="text/javascript"></script>
</head>
</html>
<body>
	<section class="container m4 clearfix">
		<div class="clearfix">
			<div class="mb4 sm-flex center nowrap">
	<div class="flex-auto block">
		<a href="/" class="btn"><p class="inline h2 author">Dev.secr3t</p> | <small class="muted">Secr3t</small></a>
	</div>
</div>

			<div class="mn1 center">
	
		<a href="/./" class="btn button-narrow">Home</a>
	
		<a href="/archives/" class="btn button-narrow">Archives</a>
	
	
	<div class="dropdown">
	    <button class="btn button-narrow">Tags</button>
        <div class="dropdown-content">
        
            <a href="/tags/hexo" class="btn"> hexo </a>
        
            <a href="/tags/think" class="btn"> think </a>
        
            <a href="/tags/dev" class="btn"> dev </a>
        
            <a href="/tags/crawler" class="btn"> crawler </a>
        
            <a href="/tags/selenium" class="btn"> selenium </a>
        
            <a href="/tags/java" class="btn"> java </a>
        
            <a href="/tags/git" class="btn"> git </a>
        
        </div>
	</div>
	
    <div class="dropdown">
	    <button class="btn button-narrow">Categories</button>
        <div class="dropdown-content">
        
            <a href="/categories/hexo" class="btn"> hexo </a>
        
            <a href="/categories/dev" class="btn"> dev </a>
        
            <a href="/categories/git" class="btn"> git </a>
        
        </div>
	</div>
<!--
	<a href="/search.html" class="btn button-narrow" onclick="loadJQuery(this, event);" data-modal>
		<svg class="icon" data-icon="search"></svg>
	</a>
-->
</div>

			<div class="p0 col col-12">
				<div class="mt2 p0">
	<span class="btn button-narrow">Tags</span>
	<svg class="icon gray" data-icon="chevron-right"/>
	<span class="btn button-narrow">java</span>
</div>

	<div class="m0 py2">
	<div class="md-col-12">
		<div class="overflow-hidden bg-white rounded">
			<div class="m1 p2 white">
				<div class="clearfix">
					<div class="left">
						<h1 class="h2 m0"><a href="/dev/2018/11/27/asynchronous-tuning.secr3t/" class="black">
						JAVA 비동기 방식 구현
						</a></h1>
					</div>
					<div class="right"><span class="h6 muted black">
						11월 27 2018
					</span></div>
				</div>
			</div>
			<div class="p2 border-top">
				<h1 id="비동기-방식이란"><a href="#비동기-방식이란" class="headerlink" title="비동기 방식이란?"></a>비동기 방식이란?</h1><h2 id="동기-VS-비동기"><a href="#동기-VS-비동기" class="headerlink" title="동기 VS 비동기"></a>동기 VS 비동기</h2><p>비동기 방식에 대해서 이야기하기전에 동기와 비동기의 차이부터 짚고 넘어가야 할 것 같다.</p>
<h3 id="1-동기-Synchronous-동시에-일어나는"><a href="#1-동기-Synchronous-동시에-일어나는" class="headerlink" title="1. 동기(Synchronous : 동시에 일어나는)"></a>1. 동기(Synchronous : 동시에 일어나는)</h3><p>동기는 말 그대로 동시에 일어난다는 뜻입니다. 요청과 그 결과가 동시에 일어난다는 것입니다.</p>
<h4 id="장점"><a href="#장점" class="headerlink" title="장점"></a>장점</h4><ul>
<li><h4 id="설계가-간단하고-직관적이다"><a href="#설계가-간단하고-직관적이다" class="headerlink" title="설계가 간단하고 직관적이다."></a>설계가 간단하고 직관적이다.</h4></li>
</ul>
<h4 id="단점"><a href="#단점" class="headerlink" title="단점"></a>단점</h4><ul>
<li><h4 id="결과가-주어질-때까지-아무것도-못하고-대기해야-한다"><a href="#결과가-주어질-때까지-아무것도-못하고-대기해야-한다" class="headerlink" title="결과가 주어질 때까지 아무것도 못하고 대기해야 한다."></a>결과가 주어질 때까지 아무것도 못하고 대기해야 한다.</h4></li>
</ul>
<h3 id="2-비동기-Asynchronous-동시에-일어나지-않는"><a href="#2-비동기-Asynchronous-동시에-일어나지-않는" class="headerlink" title="2. 비동기(Asynchronous : 동시에 일어나지 않는)"></a>2. 비동기(Asynchronous : 동시에 일어나지 않는)</h3><p>비동기는 동시에 일어나지 않는다는 뜻입니다. 요청과 결과가 동시에 일어나지 않은것이라는 하나의 약속입니다.</p>
<h4 id="단점-1"><a href="#단점-1" class="headerlink" title="단점"></a>단점</h4><ul>
<li><h4 id="설계가-동기방식보다-비교적-복잡하다"><a href="#설계가-동기방식보다-비교적-복잡하다" class="headerlink" title="설계가 동기방식보다 비교적 복잡하다."></a>설계가 동기방식보다 비교적 복잡하다.</h4></li>
</ul>
<h4 id="장점-1"><a href="#장점-1" class="headerlink" title="장점"></a>장점</h4><ul>
<li><h4 id="결과가-주어지는데-시간이-걸리더라도-그-시간-동안-다른-작업을-할-수-있다"><a href="#결과가-주어지는데-시간이-걸리더라도-그-시간-동안-다른-작업을-할-수-있다" class="headerlink" title="결과가 주어지는데 시간이 걸리더라도 그 시간 동안 다른 작업을 할 수 있다."></a>결과가 주어지는데 시간이 걸리더라도 그 시간 동안 다른 작업을 할 수 있다.</h4></li>
</ul>
<h2 id="동기-방식을-비동기-방식으로-바꾸다"><a href="#동기-방식을-비동기-방식으로-바꾸다" class="headerlink" title="동기 방식을 비동기 방식으로 바꾸다"></a>동기 방식을 비동기 방식으로 바꾸다</h2><p><a href="/dev/2018/11/03/crawler-project.secr3t/">AliExpress 크롤링프로젝트</a></p>
<ol>
<li><p>Issue - CPU 점유율 증가</p>
<ul>
<li>해당 프로젝트는 초기에 동기방식으로 설계를 진행했는데, CPU 사용량 이슈때문에 비동기방식으로 튜닝을 진행했다.</li>
</ul>
</li>
<li><p>Approach - Cycle 속도를 늦춰보자</p>
<ul>
<li>초기 동기방식 설계의 프로그램은 평균 CPU 점유율이 50% 내외를 유지하였다. 이러한 문제 때문에, 실사용에서 프로그램을 구동중에는 다른 작업을 하기 힘들었다. 문제를 해결하기 위해서 Thread.sleep(long delay) 를 이용해서 사이클 속도를 늦추면 어떨까라는 생각에 적용 및 테스트를 진행하였는데 당연하게도 CPU 점유율은 낮아졌다. 30%내외를 유지하였으며 Main thread를 제외하고 3개의 thread가 동작하고 있기 때문에 눈에띄는 효과를 얻을 수 있었다.</li>
</ul>
</li>
<li><p>Another Issue - 전체 속도 저하</p>
<ul>
<li>Cycle 속도 저하를 통해서 첫 번째 이슈는 처리했다. 하지만, 이 때문에 다른 문제가 생겼다. 자연스레 처리 속도까지 저하된 것이다. 하지만 처리속도를 높이자니 CPU 점유율 issue를 되돌릴 수는 없는 노릇이다.</li>
</ul>
</li>
<li><p>Approach - 비동기 설계로의 튜닝</p>
<ul>
<li>처리 속도는 유지하면서, 점유율 문제까지 해결해보자. Java에서는 Thread에 wait과 notify라는 형태의 비동기 방식을 지원한다. <a href="https://programmers.co.kr/learn/courses/9/lessons/278" target="_blank" rel="noopener">쓰레드와 상태제어 - programmers</a> 를 참고해보면 ‘wait과 notify는 동기화된 블록안에서 사용해야 한다. wait를 만나게 되면 해당 쓰레드는 해당 객체의 <a href="http://happinessoncode.com/2017/10/04/java-intrinsic-lock/" target="_blank" rel="noopener">모니터링 락</a>에 대한 권한을 가지고 있다면 모니터링 락의 권한을 놓고 대기한다.’ </li>
</ul>
</li>
</ol>
<p>비동기 설계로 바꾼 후</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*Crawler.java*/</span></span><br><span class="line">+	<span class="keyword">private</span> <span class="keyword">static</span> Crawler instance;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Crawler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		setDaemon(<span class="keyword">true</span>);</span><br><span class="line">+		instance = <span class="keyword">this</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">+    	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Crawler <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">+		<span class="keyword">return</span> instance;</span><br><span class="line">+	&#125;</span><br></pre></td></tr></table></figure>
<p>+는 Git의 commit 기록을 보며 추가된 부분을 표시한 것이다.<br>위의 Crawler.java를 보면 어딘가 친숙한 코드를 볼 수 있다. 바로 Singleton pattern이다. 좀 더 정확하게 하자면, Singleton pattern 을 변형하여 같은 코드블럭에 있지 않더라도 접근 할 수 있도록 설계를 수정한 것이다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*Writer.java*/</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (crawlerAlive.get() || !crawledData.isEmpty()) &#123;</span><br><span class="line">+			<span class="keyword">synchronized</span> (Crawler.getInstance()) &#123;</span><br><span class="line">+				<span class="keyword">try</span> &#123;</span><br><span class="line">+<span class="comment">//					asynchronous control</span></span><br><span class="line">+					<span class="keyword">if</span>(crawledData.isEmpty())</span><br><span class="line">+						Crawler.getInstance().wait(<span class="number">1000</span> * <span class="number">30</span>);</span><br><span class="line">+				&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">+					e.printStackTrace();</span><br><span class="line">+				&#125;</span><br><span class="line">+			&#125;</span><br><span class="line">			Data d = crawledData.poll();</span><br><span class="line">			<span class="keyword">if</span> (d != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">if</span> (wroteCount.get() % <span class="number">500</span> == <span class="number">0</span>)</span><br><span class="line">					copyExcel();</span><br><span class="line">				writeExcel(d);</span><br><span class="line">				wroteCount.getAndIncrement();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		writerAlive = <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
			</div>
			<div class="p2 border-top">
				<div class="clearfix">
					<div class="left">
						
							<script type="text/javascript">
								document.write('<a href="/tags/dev/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">dev</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/dev/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">dev</span>');
							</script>
						
							<script type="text/javascript">
								document.write('<a href="/tags/java/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">java</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/java/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">java</span>');
							</script>
						
							<script type="text/javascript">
								document.write('<a href="/tags/multithreading/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">multithreading</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/multithreading/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">multithreading</span>');
							</script>
						
							<script type="text/javascript">
								document.write('<a href="/tags/asynchronous/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">asynchronous</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/asynchronous/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">asynchronous</span>');
							</script>
						
					</div>
					<div class="ml2 right"><span class="h6 muted black">
						<a class="link" href="/categories/dev/">dev</a>
					 </span></div>
				</div>
			</div>
		</div>
	</div>
	
	
</div>


	<div class="m0 py2">
	<div class="md-col-12">
		<div class="overflow-hidden bg-white rounded">
			<div class="m1 p2 white">
				<div class="clearfix">
					<div class="left">
						<h1 class="h2 m0"><a href="/dev/2018/11/03/crawler-project.secr3t/" class="black">
						crawler-project
						</a></h1>
					</div>
					<div class="right"><span class="h6 muted black">
						11월 3 2018
					</span></div>
				</div>
			</div>
			<div class="p2 border-top">
				<h1 id="AliExpress-크롤링-프로젝트"><a href="#AliExpress-크롤링-프로젝트" class="headerlink" title="AliExpress 크롤링 프로젝트"></a>AliExpress 크롤링 프로젝트</h1><h2 id="프로젝트-정보"><a href="#프로젝트-정보" class="headerlink" title="프로젝트 정보"></a>프로젝트 정보</h2><ul>
<li><h3 id="시작일자-2018-11-01"><a href="#시작일자-2018-11-01" class="headerlink" title="시작일자 : 2018.11.01"></a>시작일자 : 2018.11.01</h3></li>
<li><h3 id="사용언어-Java-JS-아주-조금"><a href="#사용언어-Java-JS-아주-조금" class="headerlink" title="사용언어 : Java, JS(아주 조금)"></a>사용언어 : Java, JS(아주 조금)</h3></li>
<li><h3 id="사용기술"><a href="#사용기술" class="headerlink" title="사용기술"></a>사용기술</h3><ul>
<li>JAVAFX</li>
<li>JAVA-Maven</li>
<li>Selenium</li>
</ul>
</li>
<li><h3 id="개발목적-외주"><a href="#개발목적-외주" class="headerlink" title="개발목적 : 외주"></a>개발목적 : 외주</h3></li>
</ul>
<h2 id="개발-상황-정보"><a href="#개발-상황-정보" class="headerlink" title="개발 상황 정보"></a>개발 상황 정보</h2><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><h3 id="DONE"><a href="#DONE" class="headerlink" title="DONE"></a>DONE</h3><ul>
<li style="list-style: none"><input type="checkbox" checked> UI 디자인</li>
<li style="list-style: none"><input type="checkbox" checked> Reader 구현</li>
<li style="list-style: none"><input type="checkbox" checked> Crawler 구현</li>
<li style="list-style: none"><input type="checkbox" checked> ImageResize Util</li>
<li style="list-style: none"><input type="checkbox" checked> Image Differ 구현</li>
<li style="list-style: none"><input type="checkbox" checked> Excel Writer 구현</li>
<li style="list-style: none"><input type="checkbox" checked> 가격 설정 구현</li>
<li style="list-style: none"><input type="checkbox" checked> 자동종료 + 재시작</li>
<li style="list-style: none"><input type="checkbox" checked> 수집 완료시 Modal창</li>
<li style="list-style: none"><input type="checkbox" checked> 비동기 튜닝</li>
</ul>
<h2 id="SCREENSHOT"><a href="#SCREENSHOT" class="headerlink" title="SCREENSHOT"></a>SCREENSHOT</h2><p><img src="https://api-storage.cloud.toast.com/v1/AUTH_41e5ded7cb95443f8d36cff82c6e76b3/github.io-storage/imgs/crawler.PNG" alt="crawler-ui-capture"></p>
<h2 id="문제점"><a href="#문제점" class="headerlink" title="문제점(?)"></a>문제점(?)</h2><ol>
<li><p>thread를 daemon으로 설정하여도, main thread가 종료될 때, finalize를 호출하지 않는 듯 하다. 그래서, selenium과 chromedriver를 이용하는 특성 때문에 직접적으로 reader.exit() 메소드를 호출 한 후에 main thread를 종료하도록 설정하였다.</p>
</li>
<li><p>aliexpress를 js 사용 없이 확인해보면 lazy - loading이 적용되어있는 것을 확인 할 수 있는데, img 태그에 image-src 라는 속성을 잠시동안 줌으로써 page의 빠른 로딩을 꾀하였다.</p>
</li>
<li><p>java의 (iterable.)forEach method는 for문과 같이 동작하는게 아니라서 break를 쓸 수 없다. 그래서 만든것이 RuntimeException을 상속하여 BreakException이라는 custom Exception을 내부적으로 사용했다. Exception이 발생하면 그것을 catch해 forEach구문을 탈출할 수 있게 한 것이다. 이것이 for/while loop + break 와 비교했을 때 어떤 성능저하를 불러올지는 모르겠지만, 편하게 forEach를 사용하기 위해서 꼭 필요한 존재임은 확실하다.</p>
</li>
</ol>
<p>“BreakException.java”<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BreakException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2431473453374656968L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BreakException</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(arg);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>“ImageDiffer.java” 중 두 이미지를 비교하는 와중 중복되는 이미지를 발견했을 시 삽입한 코드.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (targetImage != <span class="keyword">null</span>) &#123;</span><br><span class="line">		imgs.forEach(imgName -&gt; &#123;</span><br><span class="line">			<span class="keyword">double</span> diffPercent = ImageDiff.getDifferencePercent(imageDiffPath + <span class="string">"\\"</span> + imgName,</span><br><span class="line">					targetImage);</span><br><span class="line">			<span class="keyword">if</span> (diffPercent &lt; <span class="number">10.00</span>) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> BreakException(<span class="string">"same img found :: "</span> + imgName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		passedCount.getAndIncrement();</span><br><span class="line">		String name = getNextImgName();</span><br><span class="line">		saveImg(imageSavePath, name, targetImage);</span><br><span class="line">		saveImg(imageDiffPath, name, targetImage);</span><br><span class="line">		imgs.add(name);</span><br><span class="line">		d.setMainImg(name);</span><br><span class="line"><span class="comment">//						System.out.println("DIFF :: " + d);</span></span><br><span class="line">		passedData.add(d);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (BreakException e) &#123;</span><br><span class="line">	System.out.println(e.getMessage());</span><br><span class="line">	<span class="keyword">continue</span>;</span><br><span class="line">	<span class="comment">// 같은 이미지 발견</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>javaFX 관련 문제점<br>javaFX Thread가 아닌 Thread (따로 작성한 thread class, 익명 thread class 등..) 에서 javaFX UI에 관련된 명령을 실행할 경우</li>
</ol>
<p>&lt;java.lang.IllegalStateException: Not on FX application thread; currentThread = Thread-9&gt;</p>
<p>위와 같은 Exception이 발생하게 되어있다. 따라서, 해당 명령을 javaFX Thread가 아닌 곳에서 실행시키고 싶을 경우<br>다음과 같은 코드로 익명 javaFX thread를 생성 및 실행할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Platform.runLater( ()-&gt; &#123;	<span class="comment">// java lambda expression</span></span><br><span class="line">	doStuffRelatedJavaFx();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>javaFX application의 재시작 구성</li>
</ol>
<p>“AECController.java” 에서의 restart() method<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	reader.exit();	<span class="comment">// reader 내에 chromeDriver를 다루고 있기 때문에 정상동작을 위해서는 reader를 종료한 후에 동작해야 한다.</span></span><br><span class="line">	saveConfs();</span><br><span class="line">	Main.restart();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>“Main.java” 의 구성</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> application;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javafx.application.Application;</span><br><span class="line"><span class="keyword">import</span> javafx.application.Platform;</span><br><span class="line"><span class="keyword">import</span> javafx.stage.Stage;</span><br><span class="line"><span class="keyword">import</span> javafx.scene.Scene;</span><br><span class="line"><span class="keyword">import</span> javafx.scene.layout.AnchorPane;</span><br><span class="line"><span class="keyword">import</span> javafx.fxml.FXMLLoader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Stage stage;	<span class="comment">// stage를 종료하기 위해서는 static으로 설정하는것이 좋다.</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(Stage primaryStage)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			AnchorPane root = (AnchorPane)FXMLLoader.load(getClass().getResource(<span class="string">"ali.fxml"</span>));</span><br><span class="line">			Scene scene = <span class="keyword">new</span> Scene(root);</span><br><span class="line">			primaryStage.setScene(scene);</span><br><span class="line">			primaryStage.show();</span><br><span class="line">			primaryStage.setResizable(<span class="keyword">false</span>);</span><br><span class="line">			stage = primaryStage;</span><br><span class="line">		&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		stage.close();</span><br><span class="line">		Platform.runLater( ()-&gt;&#123;</span><br><span class="line">			<span class="keyword">new</span> Main().start( <span class="keyword">new</span> Stage() );</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		launch(args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="COMMENT"><a href="#COMMENT" class="headerlink" title="COMMENT"></a>COMMENT</h2><p>[2018-11-03] 개발에 지칠땐 포스팅이 최고인듯 하다.<br>[2018-11-06] 일단 구현하려했던 것들을 모두 구현하였다. 추가적으로 작업할 것은 남아있지만 이 정도 개발속도면 나름 만족스럽다.<br>[2018-11-27] 마지막으로 기능 추가요청과 함께, 프로그램 사용에 따른 전체 PC 속도 저하문제에 관한 분석 요청을 해주셨는데 그에 따라 단순 multi-threading 을 비동기방식으로 튜닝하여 CPU usage reducing에 성공하였다.</p>

			</div>
			<div class="p2 border-top">
				<div class="clearfix">
					<div class="left">
						
							<script type="text/javascript">
								document.write('<a href="/tags/dev/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">dev</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/dev/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">dev</span>');
							</script>
						
							<script type="text/javascript">
								document.write('<a href="/tags/java/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">java</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/java/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">java</span>');
							</script>
						
							<script type="text/javascript">
								document.write('<a href="/tags/crawler/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">crawler</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/crawler/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">crawler</span>');
							</script>
						
							<script type="text/javascript">
								document.write('<a href="/tags/selenium/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">selenium</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/selenium/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">selenium</span>');
							</script>
						
					</div>
					<div class="ml2 right"><span class="h6 muted black">
						<a class="link" href="/categories/dev/">dev</a>
					 </span></div>
				</div>
			</div>
		</div>
	</div>
	
	
</div>


<div class="clearfix">
	
	
	<div class="overflow-hidden sm-show center">
		
			<a href="/tags/java/" class="btn btn-primary bg-gray">1</a>
		
		
		
			
		
			
		
		
		
			
		
			
		

		

		
	</div>
</div>


			</div>
		</div>
	</section>
	<div class="container mb2 clearfix">
    <div class="sm-flex center nowrap mb2 h5">
        <div class="flex-auto border-bottom">
           Powered by
            <a href="https://hexo.io/" class="btn block ">Hexo</a>
        </div>
        <div class="flex-auto border-bottom">
           Original Theme
            <a href="https://zllovesuki.git.sx/essays/2016/02/hexo-theme-weightless/" class="btn block ">Weightless</a>
        </div>
        <div class="flex-auto border-bottom">
            Owner <a href="mailto:dev.secr3t@gmail.com?subject=qna-to-dev_secr3t" class="btn block author ">Dev.secr3t</a>
        </div>
        <div class="flex-auto border-bottom">
            FONT <a href="https://github.com/naver/d2codingfont" class="btn block green ">Naver D2Coding</a>
        </div>
        
    </div>
</div>
<script src="/js/geomicons.js"></script>
<script type="text/javascript">
    var icons = document.querySelectorAll('[data-icon]');
    geomicons.inject(icons);

</script>



</body>
</html>
