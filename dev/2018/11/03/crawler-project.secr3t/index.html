<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
	<meta charset="utf-8">

	

	<title>crawler-project | Dev.secr3t</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
	
	  
    
    <link rel="icon" href="/favicon.png">
    
<!--
	<link rel="preload" href="/css/D2Coding.woff2" as="font" type="font/woff2" crossorigin="anonymous">
	<link rel="preload" href="/css/D2Coding.ttf" as="font" type="font/ttf" crossorigin="anonymous">
	<link rel="preload" href="/css/D2CodingBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
	<link rel="preload" href="/css/D2CodingBold.ttf" as="font" type="font/ttf" crossorigin="anonymous">
	<link rel="stylesheet" href="/css/d2coding.css" type="text/css"> -->
	<link rel="preload" href="/css/D2Coding.woff" as="font" type="font/woff" crossorigin="anonymous">
	<link rel="preload" href="/css/D2CodingBold.woff" as="font" type="font/woff" crossorigin="anonymous">
	<!-- <link rel="preload" href="/css/style.css" as="style" type="text/css" crossorigin="anonymous"> -->
	<link rel="stylesheet" href="/css/normalize.css" type="text/css">
	<link rel="stylesheet" href="/css/basscss.css" type="text/css">
	<link rel="stylesheet" href="/css/basscss-ui-groups.css" type="text/css">
	<link rel="stylesheet" href="/css/tomorrow.css" type="text/css">
	<link rel="stylesheet" href="/css/style.css" type="text/css">
	
		<link href="https://rachel.objectstore.co/dist/fonts/lato-v13/lato-v13-all.css" rel="stylesheet" type="text/css">
	
	

	<!--[if lt IE 9]><script src="/js/html5.js" type="text/javascript"></script><![endif]-->
	<script src="/js/main.js" type="text/javascript"></script>
</head>
</html>
<body>
	<section class="container m4 clearfix">
		<div class="clearfix">
			<div class="mb4 sm-flex center nowrap">
	<div class="flex-auto block">
		<a href="/" class="btn"><p class="inline h2 author">Dev.secr3t</p> | <small class="muted">Secr3t</small></a>
	</div>
</div>

			<div class="mn1 center">
	
		<a href="/./" class="btn button-narrow">Home</a>
	
		<a href="/archives/" class="btn button-narrow">Archives</a>
	
	
	<div class="dropdown">
	    <button class="btn button-narrow">Tags</button>
        <div class="dropdown-content">
        
            <a href="/tags/hexo" class="btn"> hexo </a>
        
            <a href="/tags/think" class="btn"> think </a>
        
            <a href="/tags/dev" class="btn"> dev </a>
        
            <a href="/tags/crawler" class="btn"> crawler </a>
        
            <a href="/tags/selenium" class="btn"> selenium </a>
        
            <a href="/tags/java" class="btn"> java </a>
        
            <a href="/tags/git" class="btn"> git </a>
        
        </div>
	</div>
	
    <div class="dropdown">
	    <button class="btn button-narrow">Categories</button>
        <div class="dropdown-content">
        
            <a href="/categories/hexo" class="btn"> hexo </a>
        
            <a href="/categories/dev" class="btn"> dev </a>
        
            <a href="/categories/git" class="btn"> git </a>
        
        </div>
	</div>
<!--
	<a href="/search.html" class="btn button-narrow" onclick="loadJQuery(this, event);" data-modal>
		<svg class="icon" data-icon="search"></svg>
	</a>
-->
</div>

			<div class="p0 col col-12">
				<div class="m0 py2">
	<div class="md-col-12">
		<div class="overflow-hidden bg-white rounded">
			<div class="m1 p2 white">
				<div class="clearfix">
					<div class="left">
						<h1 class="h2 m0"><a href="/dev/2018/11/03/crawler-project.secr3t/" class="black">
						crawler-project
						</a></h1>
					</div>
					<div class="right"><span class="h6 muted black">
						11월 3 2018
					</span></div>
				</div>
			</div>
			<div class="p2 border-top">
				<h1 id="AliExpress-크롤링-프로젝트"><a href="#AliExpress-크롤링-프로젝트" class="headerlink" title="AliExpress 크롤링 프로젝트"></a>AliExpress 크롤링 프로젝트</h1><h2 id="프로젝트-정보"><a href="#프로젝트-정보" class="headerlink" title="프로젝트 정보"></a>프로젝트 정보</h2><ul>
<li><h3 id="시작일자-2018-11-01"><a href="#시작일자-2018-11-01" class="headerlink" title="시작일자 : 2018.11.01"></a>시작일자 : 2018.11.01</h3></li>
<li><h3 id="사용언어-Java-JS-아주-조금"><a href="#사용언어-Java-JS-아주-조금" class="headerlink" title="사용언어 : Java, JS(아주 조금)"></a>사용언어 : Java, JS(아주 조금)</h3></li>
<li><h3 id="사용기술"><a href="#사용기술" class="headerlink" title="사용기술"></a>사용기술</h3><ul>
<li>JAVAFX</li>
<li>JAVA-Maven</li>
<li>Selenium</li>
</ul>
</li>
<li><h3 id="개발목적-외주"><a href="#개발목적-외주" class="headerlink" title="개발목적 : 외주"></a>개발목적 : 외주</h3></li>
</ul>
<h2 id="개발-상황-정보"><a href="#개발-상황-정보" class="headerlink" title="개발 상황 정보"></a>개발 상황 정보</h2><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><h3 id="DONE"><a href="#DONE" class="headerlink" title="DONE"></a>DONE</h3><ul>
<li style="list-style: none"><input type="checkbox" checked> UI 디자인</li>
<li style="list-style: none"><input type="checkbox" checked> Reader 구현</li>
<li style="list-style: none"><input type="checkbox" checked> Crawler 구현</li>
<li style="list-style: none"><input type="checkbox" checked> ImageResize Util</li>
<li style="list-style: none"><input type="checkbox" checked> Image Differ 구현</li>
<li style="list-style: none"><input type="checkbox" checked> Excel Writer 구현</li>
<li style="list-style: none"><input type="checkbox" checked> 가격 설정 구현</li>
<li style="list-style: none"><input type="checkbox" checked> 자동종료 + 재시작</li>
<li style="list-style: none"><input type="checkbox" checked> 수집 완료시 Modal창</li>
<li style="list-style: none"><input type="checkbox" checked> 비동기 튜닝</li>
</ul>
<h2 id="SCREENSHOT"><a href="#SCREENSHOT" class="headerlink" title="SCREENSHOT"></a>SCREENSHOT</h2><p><img src="https://api-storage.cloud.toast.com/v1/AUTH_41e5ded7cb95443f8d36cff82c6e76b3/github.io-storage/imgs/crawler.PNG" alt="crawler-ui-capture"></p>
<h2 id="문제점"><a href="#문제점" class="headerlink" title="문제점(?)"></a>문제점(?)</h2><ol>
<li><p>thread를 daemon으로 설정하여도, main thread가 종료될 때, finalize를 호출하지 않는 듯 하다. 그래서, selenium과 chromedriver를 이용하는 특성 때문에 직접적으로 reader.exit() 메소드를 호출 한 후에 main thread를 종료하도록 설정하였다.</p>
</li>
<li><p>aliexpress를 js 사용 없이 확인해보면 lazy - loading이 적용되어있는 것을 확인 할 수 있는데, img 태그에 image-src 라는 속성을 잠시동안 줌으로써 page의 빠른 로딩을 꾀하였다.</p>
</li>
<li><p>java의 (iterable.)forEach method는 for문과 같이 동작하는게 아니라서 break를 쓸 수 없다. 그래서 만든것이 RuntimeException을 상속하여 BreakException이라는 custom Exception을 내부적으로 사용했다. Exception이 발생하면 그것을 catch해 forEach구문을 탈출할 수 있게 한 것이다. 이것이 for/while loop + break 와 비교했을 때 어떤 성능저하를 불러올지는 모르겠지만, 편하게 forEach를 사용하기 위해서 꼭 필요한 존재임은 확실하다.</p>
</li>
</ol>
<p>“BreakException.java”<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BreakException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2431473453374656968L</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">BreakException</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(arg);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>“ImageDiffer.java” 중 두 이미지를 비교하는 와중 중복되는 이미지를 발견했을 시 삽입한 코드.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (targetImage != <span class="keyword">null</span>) &#123;</span><br><span class="line">		imgs.forEach(imgName -&gt; &#123;</span><br><span class="line">			<span class="keyword">double</span> diffPercent = ImageDiff.getDifferencePercent(imageDiffPath + <span class="string">"\\"</span> + imgName,</span><br><span class="line">					targetImage);</span><br><span class="line">			<span class="keyword">if</span> (diffPercent &lt; <span class="number">10.00</span>) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> BreakException(<span class="string">"same img found :: "</span> + imgName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		passedCount.getAndIncrement();</span><br><span class="line">		String name = getNextImgName();</span><br><span class="line">		saveImg(imageSavePath, name, targetImage);</span><br><span class="line">		saveImg(imageDiffPath, name, targetImage);</span><br><span class="line">		imgs.add(name);</span><br><span class="line">		d.setMainImg(name);</span><br><span class="line"><span class="comment">//						System.out.println("DIFF :: " + d);</span></span><br><span class="line">		passedData.add(d);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (BreakException e) &#123;</span><br><span class="line">	System.out.println(e.getMessage());</span><br><span class="line">	<span class="keyword">continue</span>;</span><br><span class="line">	<span class="comment">// 같은 이미지 발견</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>javaFX 관련 문제점<br>javaFX Thread가 아닌 Thread (따로 작성한 thread class, 익명 thread class 등..) 에서 javaFX UI에 관련된 명령을 실행할 경우</li>
</ol>
<p>&lt;java.lang.IllegalStateException: Not on FX application thread; currentThread = Thread-9&gt;</p>
<p>위와 같은 Exception이 발생하게 되어있다. 따라서, 해당 명령을 javaFX Thread가 아닌 곳에서 실행시키고 싶을 경우<br>다음과 같은 코드로 익명 javaFX thread를 생성 및 실행할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Platform.runLater( ()-&gt; &#123;	<span class="comment">// java lambda expression</span></span><br><span class="line">	doStuffRelatedJavaFx();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>javaFX application의 재시작 구성</li>
</ol>
<p>“AECController.java” 에서의 restart() method<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	reader.exit();	<span class="comment">// reader 내에 chromeDriver를 다루고 있기 때문에 정상동작을 위해서는 reader를 종료한 후에 동작해야 한다.</span></span><br><span class="line">	saveConfs();</span><br><span class="line">	Main.restart();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>“Main.java” 의 구성</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> application;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javafx.application.Application;</span><br><span class="line"><span class="keyword">import</span> javafx.application.Platform;</span><br><span class="line"><span class="keyword">import</span> javafx.stage.Stage;</span><br><span class="line"><span class="keyword">import</span> javafx.scene.Scene;</span><br><span class="line"><span class="keyword">import</span> javafx.scene.layout.AnchorPane;</span><br><span class="line"><span class="keyword">import</span> javafx.fxml.FXMLLoader;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Stage stage;	<span class="comment">// stage를 종료하기 위해서는 static으로 설정하는것이 좋다.</span></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">(Stage primaryStage)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			AnchorPane root = (AnchorPane)FXMLLoader.load(getClass().getResource(<span class="string">"ali.fxml"</span>));</span><br><span class="line">			Scene scene = <span class="keyword">new</span> Scene(root);</span><br><span class="line">			primaryStage.setScene(scene);</span><br><span class="line">			primaryStage.show();</span><br><span class="line">			primaryStage.setResizable(<span class="keyword">false</span>);</span><br><span class="line">			stage = primaryStage;</span><br><span class="line">		&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">restart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		stage.close();</span><br><span class="line">		Platform.runLater( ()-&gt;&#123;</span><br><span class="line">			<span class="keyword">new</span> Main().start( <span class="keyword">new</span> Stage() );</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		launch(args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="COMMENT"><a href="#COMMENT" class="headerlink" title="COMMENT"></a>COMMENT</h2><p>[2018-11-03] 개발에 지칠땐 포스팅이 최고인듯 하다.<br>[2018-11-06] 일단 구현하려했던 것들을 모두 구현하였다. 추가적으로 작업할 것은 남아있지만 이 정도 개발속도면 나름 만족스럽다.<br>[2018-11-27] 마지막으로 기능 추가요청과 함께, 프로그램 사용에 따른 전체 PC 속도 저하문제에 관한 분석 요청을 해주셨는데 그에 따라 단순 multi-threading 을 비동기방식으로 튜닝하여 CPU usage reducing에 성공하였다.</p>

			</div>
			<div class="p2 border-top">
				<div class="clearfix">
					<div class="left">
						
							<script type="text/javascript">
								document.write('<a href="/tags/dev/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">dev</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/dev/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">dev</span>');
							</script>
						
							<script type="text/javascript">
								document.write('<a href="/tags/java/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">java</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/java/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">java</span>');
							</script>
						
							<script type="text/javascript">
								document.write('<a href="/tags/crawler/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">crawler</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/crawler/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">crawler</span>');
							</script>
						
							<script type="text/javascript">
								document.write('<a href="/tags/selenium/" class="muted h6 mb1 bold btn btn-outline '+chooseOne(colors)+'">selenium</a>');
								//document.write('<span onclick="window.location=\'' + ' /tags/selenium/ ' + '\'" class="clickable h6 bold inline-block px1 '+chooseOne(colors)+' rounded">selenium</span>');
							</script>
						
					</div>
					<div class="ml2 right"><span class="h6 muted black">
						<a class="link" href="/categories/dev/">dev</a>
					 </span></div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="clearfix mt2">
		
			<a href="/git/2018/11/12/private-git-bitbucket.secr3t/" class="left btn">
			<svg class="icon" data-icon="chevron-left"/>
			prev: private-git-bitbucket
		</a>
		
		
		<a href="/uncategorized/2018/10/29/DOING.secr3t/" class="right btn">
			next: DOING
			<svg class="icon" data-icon="chevron-right"/>
		</a>
		
	</div>
	
	
</div>


			</div>
		</div>
	</section>
	<div class="container mb2 clearfix">
    <div class="sm-flex center nowrap mb2 h5">
        <div class="flex-auto border-bottom">
           Powered by
            <a href="https://hexo.io/" class="btn block ">Hexo</a>
        </div>
        <div class="flex-auto border-bottom">
           Original Theme
            <a href="https://zllovesuki.git.sx/essays/2016/02/hexo-theme-weightless/" class="btn block ">Weightless</a>
        </div>
        <div class="flex-auto border-bottom">
            Owner <a href="mailto:dev.secr3t@gmail.com?subject=qna-to-dev_secr3t" class="btn block author ">Dev.secr3t</a>
        </div>
        <div class="flex-auto border-bottom">
            FONT <a href="https://github.com/naver/d2codingfont" class="btn block green ">Naver D2Coding</a>
        </div>
        
    </div>
</div>
<script src="/js/geomicons.js"></script>
<script type="text/javascript">
    var icons = document.querySelectorAll('[data-icon]');
    geomicons.inject(icons);

</script>



</body>
</html>
